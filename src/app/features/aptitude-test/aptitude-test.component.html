<div class="test-container">
  <mat-card class="aethelgard-card">
    <mat-card-header>
      <mat-card-title>EVALUATION PROTOCOL v1.0</mat-card-title>
    </mat-card-header>
    <mat-card-content *ngIf="questions().length > 0; else loading">
      <div *ngIf="!isFinished(); else results">
        <h3>Question {{currentIndex() + 1}} of {{questions().length}}</h3>
        <mat-progress-bar mode="determinate" [value]="progress" class="step-progress"></mat-progress-bar>
        
        <p class="question-text">{{questions()[currentIndex()].text}}</p>
        
        <mat-radio-group [ngModel]="selectedWeight()" (ngModelChange)="selectedWeight.set($event)" class="options-group">
          <mat-radio-button *ngFor="let opt of questions()[currentIndex()].options" [value]="opt.roleWeight">
            {{opt.text}}
          </mat-radio-button>
        </mat-radio-group>
      </div>
      
      <ng-template #results>
        <div class="results-screen">
          <h2>ANALYSIS COMPLETED</h2>
          <p>Your assigned profile is: <strong>{{finalRole() | uppercase}}</strong></p>
          <button mat-raised-button color="primary" (click)="saveAndOnboard()">ACCEPT ROLE AND DOWNLOAD APP</button>
        </div>
      </ng-template>
    </mat-card-content>

    <ng-template #loading>
      <mat-card-content>
        <p>Initializing analysis... Please wait.</p>
      </mat-card-content>
    </ng-template>
    
    <mat-card-actions *ngIf="!isFinished() && questions().length > 0">
      <button mat-button (click)="nextQuestion()" [disabled]="!selectedWeight()">
        {{ currentIndex() === questions().length - 1 ? 'FINISH' : 'NEXT >' }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>
